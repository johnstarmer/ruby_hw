---
- hosts: all
  sudo: no

####
  tasks:
  - name: Install dependencies
    apt:
        name={{ item }}
        update_cache=yes
    with_items:
        - python-dev
        - python-setuptools

  - name: Install pip
    easy_install:
        name=pip

  - name: Install docker-py
    pip:
        name=docker-py
        state=present
        version=1.1.0

#####
  - name: Add docker apt repo
    apt_repository:
        repo='deb https://apt.dockerproject.org/repo ubuntu-{{ ansible_distribution_release }} main'
        state=present

  - name: Import the Docker repository key
    apt_key:
        url=https://apt.dockerproject.org/gpg
        state=present
        id=2C52609D

  - name: Install Docker package
    apt:
        name=docker-engine
        update_cache=yes

####
  - name: add travis-ci public key
    lineinfile: dest=/root/.ssh/authorized_keys line='ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDVimlbl7z7ru6STu7r+MAmtipKk6SYNQh3z89tF42CAlvEx9XogXJtzSBImZ6fBStSLfuCBLJVGvXA8v6ko6s4McgLVAJLlB+X1RTAXSqoJb0Xra9meJj8OhsuGRXkWVCv3xAZGmWrfLGEvQUl2W9SEsvXObNfOC6l7QA1QcUydcJsfxRaJYTnopZw2/Y2Y4tGhYfDAnxb8ytZrSkqb2gZzqMvEUwWFquPm5bUfwiDRKjIHVRTYchf4TwkJ9pcHtnF6gL3vbANIk/OhSUwQvpRdpcqmDji1OGVTVZLrPWKQgyJnhWTZPuopJOdn/1lkkOelj4XxqijuahuiQqwZdup'


####
  - name: application container
    docker:
      name: ruby-hw
      image: rstarmer/ruby-hw
      state: reloaded
      pull: always
      ports:
      - "80:80"
      - "22:2222"
